#!/bin/bash

# ========================================
# ะกะะะะะข ะะะขะะะะะะฆะะ ะะะะะะะะะะะ VRNHoney
# ========================================
# 
# ะญัะพั ัะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะธะผะธะทะธััะตั ะฒัะต ะธะทะพะฑัะฐะถะตะฝะธั ะฝะฐ ัะฐะนัะต VRNHoney
# ะดะปั ัะปัััะตะฝะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะธ ัะผะตะฝััะตะฝะธั ัะฐะทะผะตัะฐ ัะฐะนะปะพะฒ.
# 
# ะคัะฝะบัะธะธ ัะบัะธะฟัะฐ:
# - ะะฒัะพะผะฐัะธัะตัะบะพะต ะธะทะผะตะฝะตะฝะธะต ัะฐะทะผะตัะพะฒ ะธะทะพะฑัะฐะถะตะฝะธะน
# - ะกะถะฐัะธะต JPEG ั ัะพััะฐะฝะตะฝะธะตะผ ะบะฐัะตััะฒะฐ
# - ะกะพะทะดะฐะฝะธะต WebP ะฒะตััะธะน ะดะปั ัะพะฒัะตะผะตะฝะฝัั ะฑัะฐัะทะตัะพะฒ
# - ะะตะฝะตัะฐัะธั ะพััะตัะพะฒ ะพะฑ ะพะฟัะธะผะธะทะฐัะธะธ
# 
# ะขัะตะฑะพะฒะฐะฝะธั:
# - ImageMagick (ะดะปั ะธะทะผะตะฝะตะฝะธั ัะฐะทะผะตัะพะฒ ะธ ะบะพะฝะฒะตััะฐัะธะธ)
# - jpegoptim (ะดะปั ัะถะฐัะธั JPEG)
# 
# ะะฒัะพั: Cursor Agent
# ะะฐัะฐ: 19 ะดะตะบะฐะฑัั 2024
# ะะตััะธั: 2.0.0

echo "๐ฏ ะะฟัะธะผะธะทะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน ะดะปั VRNHoney..."

# ========================================
# ะะะะะะะะ ะะะะะกะะะะกะขะะ
# ========================================

# ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต ImageMagick ะดะปั ะพะฑัะฐะฑะพัะบะธ ะธะทะพะฑัะฐะถะตะฝะธะน
if ! command -v convert &> /dev/null; then
    echo "โ ImageMagick ะฝะต ัััะฐะฝะพะฒะปะตะฝ. ะฃััะฐะฝะพะฒะธัะต: sudo apt-get install imagemagick"
    exit 1
fi

# ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต jpegoptim ะดะปั ัะถะฐัะธั JPEG ัะฐะนะปะพะฒ
if ! command -v jpegoptim &> /dev/null; then
    echo "โ jpegoptim ะฝะต ัััะฐะฝะพะฒะปะตะฝ. ะฃััะฐะฝะพะฒะธัะต: sudo apt-get install jpegoptim"
    exit 1
fi

# ะกะพะทะดะฐะตะผ ะฟะฐะฟะบั ะดะปั ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัั ะธะทะพะฑัะฐะถะตะฝะธะน
mkdir -p images/optimized

# ========================================
# ะะะขะะะะะะฆะะฏ ะคะะะะะะะ ะะะะะะะะะะะฏ
# ========================================

# ะะฟัะธะผะธะทะธััะตะผ ะพัะฝะพะฒะฝะพะต ัะพะฝะพะฒะพะต ะธะทะพะฑัะฐะถะตะฝะธะต ัะฐะนัะฐ
echo "๐ธ ะะฟัะธะผะธะทะฐัะธั ัะพะฝะพะฒะพะณะพ ะธะทะพะฑัะฐะถะตะฝะธั..."
if [ -f "images/Background.jpeg" ]; then
    # ะะทะผะตะฝัะตะผ ัะฐะทะผะตั ะดะพ Full HD (1920x1080) ั ัะพััะฐะฝะตะฝะธะตะผ ะฟัะพะฟะพััะธะน
    convert "images/Background.jpeg" -quality 85 -resize 1920x1080^ "images/optimized/Background-optimized.jpeg"
    
    # ะกะถะธะผะฐะตะผ JPEG ะดะพ 80% ะบะฐัะตััะฒะฐ ะดะปั ัะผะตะฝััะตะฝะธั ัะฐะทะผะตัะฐ
    jpegoptim --strip-all --max=80 "images/optimized/Background-optimized.jpeg"
    
    echo "โ Background.jpeg ะพะฟัะธะผะธะทะธัะพะฒะฐะฝ"
fi

# ========================================
# ะะะขะะะะะะฆะะฏ ะะะะะะะะะะะ ะะะะะะะ
# ========================================

# ะะฑัะฐะฑะฐััะฒะฐะตะผ ะฒัะต ะธะทะพะฑัะฐะถะตะฝะธั ะฒ ะณะฐะปะตัะตะต ะดะปั ัะพะทะดะฐะฝะธั ะฐะดะฐะฟัะธะฒะฝัั ะฒะตััะธะน
echo "๐ผ๏ธ ะะฟัะธะผะธะทะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน ะณะฐะปะตัะตะธ..."
for img in images/*.jpg; do
    if [ -f "$img" ]; then
        filename=$(basename "$img")
        echo "ะะฑัะฐะฑะฐััะฒะฐั: $filename"
        
        # ะกะพะทะดะฐะตะผ ะฝะตัะบะพะปัะบะพ ัะฐะทะผะตัะพะฒ ะดะปั ะฐะดะฐะฟัะธะฒะฝะพััะธ (responsive images)
        # 800w - ะดะปั ะฑะพะปััะธั ัะบัะฐะฝะพะฒ
        convert "$img" -quality 85 -resize 800x600^ "images/optimized/${filename%.*}-800w.jpg"
        # 400w - ะดะปั ััะตะดะฝะธั ัะบัะฐะฝะพะฒ
        convert "$img" -quality 85 -resize 400x300^ "images/optimized/${filename%.*}-400w.jpg"
        # 200w - ะดะปั ะผะพะฑะธะปัะฝัั ััััะพะนััะฒ
        convert "$img" -quality 85 -resize 200x150^ "images/optimized/${filename%.*}-200w.jpg"
        
        # ะะฟัะธะผะธะทะธััะตะผ ะบะฐะถะดัะน ัะฐะทะผะตั ะดะปั ัะผะตะฝััะตะฝะธั ัะฐะทะผะตัะฐ ัะฐะนะปะฐ
        jpegoptim --strip-all --max=80 "images/optimized/${filename%.*}-800w.jpg"
        jpegoptim --strip-all --max=80 "images/optimized/${filename%.*}-400w.jpg"
        jpegoptim --strip-all --max=80 "images/optimized/${filename%.*}-200w.jpg"
    fi
done

# ========================================
# ะกะะะะะะะ WEBP ะะะะกะะ
# ========================================

# ะกะพะทะดะฐะตะผ WebP ะฒะตััะธะธ ะดะปั ัะพะฒัะตะผะตะฝะฝัั ะฑัะฐัะทะตัะพะฒ
# WebP ะพะฑะตัะฟะตัะธะฒะฐะตั ะปัััะตะต ัะถะฐัะธะต ะฟัะธ ัะพััะฐะฝะตะฝะธะธ ะบะฐัะตััะฒะฐ
echo "๐ ะกะพะทะดะฐะฝะธะต WebP ะฒะตััะธะน..."
for img in images/optimized/*.jpg; do
    if [ -f "$img" ]; then
        filename=$(basename "$img" .jpg)
        # ะะพะฝะฒะตััะธััะตะผ JPEG ะฒ WebP ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะพะฟัะตะดะตะปะตะฝะธะตะผ ะบะฐัะตััะฒะฐ
        convert "$img" "images/optimized/${filename}.webp"
        echo "โ ะกะพะทะดะฐะฝ WebP: ${filename}.webp"
    fi
done

# ========================================
# ะกะะะะะะะ ะะขะงะะขะ ะะ ะะะขะะะะะะฆะะ
# ========================================

# ะะตะฝะตัะธััะตะผ ะฟะพะดัะพะฑะฝัะน ะพััะตั ะพ ะฟัะพะดะตะปะฐะฝะฝะพะน ัะฐะฑะพัะต
echo "๐ ะกะพะทะดะฐะฝะธะต ะพััะตัะฐ ะพะฑ ะพะฟัะธะผะธะทะฐัะธะธ..."
echo "# ะััะตั ะพะฑ ะพะฟัะธะผะธะทะฐัะธะธ ะธะทะพะฑัะฐะถะตะฝะธะน VRNHoney" > "images/optimization-report.md"
echo "ะะฐัะฐ: $(date)" >> "images/optimization-report.md"
echo "" >> "images/optimization-report.md"
echo "## ๐ ะะตะทัะปััะฐัั ะพะฟัะธะผะธะทะฐัะธะธ" >> "images/optimization-report.md"
echo "" >> "images/optimization-report.md"
echo "### ะคะพะฝะพะฒะพะต ะธะทะพะฑัะฐะถะตะฝะธะต" >> "images/optimization-report.md"
if [ -f "images/Background.jpeg" ] && [ -f "images/optimized/Background-optimized.jpeg" ]; then
    original_size=$(du -h "images/Background.jpeg" | cut -f1)
    optimized_size=$(du -h "images/optimized/Background-optimized.jpeg" | cut -f1)
    echo "- ะัะธะณะธะฝะฐะป: $original_size" >> "images/optimization-report.md"
    echo "- ะะฟัะธะผะธะทะธัะพะฒะฐะฝะพ: $optimized_size" >> "images/optimization-report.md"
fi
echo "" >> "images/optimization-report.md"
echo "### ะะฐะปะตัะตั ะธะทะพะฑัะฐะถะตะฝะธะน" >> "images/optimization-report.md"
echo "- ะกะพะทะดะฐะฝะพ ะฐะดะฐะฟัะธะฒะฝัั ะฒะตััะธะน: $(ls images/optimized/*-800w.jpg 2>/dev/null | wc -l)" >> "images/optimization-report.md"
echo "- WebP ะฒะตััะธะน: $(ls images/optimized/*.webp 2>/dev/null | wc -l)" >> "images/optimization-report.md"
echo "" >> "images/optimization-report.md"
echo "## ๐๏ธ ะัะฟะพะปัะทะพะฒะฐะฝะฝัะต ะธะฝััััะผะตะฝัั" >> "images/optimization-report.md"
echo "- ImageMagick: $(convert --version | head -1)" >> "images/optimization-report.md"
echo "- jpegoptim: $(jpegoptim --version | head -1)" >> "images/optimization-report.md"
echo "" >> "images/optimization-report.md"
echo "## ๐ฑ ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั" >> "images/optimization-report.md"
echo "1. ะัะฟะพะปัะทัะนัะต ะธะทะพะฑัะฐะถะตะฝะธั ั ััััะธะบัะพะผ -800w ะดะปั ะฑะพะปััะธั ัะบัะฐะฝะพะฒ" >> "images/optimization-report.md"
echo "2. ะัะฟะพะปัะทัะนัะต ะธะทะพะฑัะฐะถะตะฝะธั ั ััััะธะบัะพะผ -400w ะดะปั ะฟะปะฐะฝัะตัะพะฒ" >> "images/optimization-report.md"
echo "3. ะัะฟะพะปัะทัะนัะต ะธะทะพะฑัะฐะถะตะฝะธั ั ััััะธะบัะพะผ -200w ะดะปั ะผะพะฑะธะปัะฝัั ััััะพะนััะฒ" >> "images/optimization-report.md"
echo "4. WebP ะฒะตััะธะธ ะดะปั ัะพะฒัะตะผะตะฝะฝัั ะฑัะฐัะทะตัะพะฒ ั ะฟะพะดะดะตัะถะบะพะน ััะพะณะพ ัะพัะผะฐัะฐ" >> "images/optimization-report.md"

echo "โ ะััะตั ัะพััะฐะฝะตะฝ ะฒ: images/optimization-report.md"
echo "๐ WebP ะฒะตััะธะธ ัะพะทะดะฐะฝั ะดะปั ัะพะฒัะตะผะตะฝะฝัั ะฑัะฐัะทะตัะพะฒ"

# ========================================
# ะะซะะะ ะกะขะะขะะกะขะะะ ะะะขะะะะะะฆะะ
# ========================================

# ะะพะบะฐะทัะฒะฐะตะผ ะธัะพะณะพะฒัั ััะฐัะธััะธะบั ะฟะพ ะฟัะพะดะตะปะฐะฝะฝะพะน ัะฐะฑะพัะต
echo ""
echo "๐ ะกัะฐัะธััะธะบะฐ ะพะฟัะธะผะธะทะฐัะธะธ:"
echo "ะัะธะณะธะฝะฐะปัะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั: $(ls images/*.jpg images/*.jpeg 2>/dev/null | wc -l)"
echo "ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั: $(ls images/optimized/*.jpg 2>/dev/null | wc -l)"
echo "WebP ะฒะตััะธะธ: $(ls images/optimized/*.webp 2>/dev/null | wc -l)"

echo ""
echo "๐ ะะฟัะธะผะธะทะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน ะทะฐะฒะตััะตะฝะฐ!"
echo "๐ ะะตะทัะปััะฐัั ัะพััะฐะฝะตะฝั ะฒ ะฟะฐะฟะบะต: images/optimized/"